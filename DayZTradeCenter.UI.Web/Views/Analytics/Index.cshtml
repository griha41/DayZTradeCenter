@model DayZTradeCenter.UI.Web.Models.AnalyticsViewModel

@{
    ViewBag.Title = "Index";
}

<div class="row" style="margin-bottom: -10px">
    <div class="col-md-1"><h2>Analytics</h2></div>
    <div class="col-md-6" style="margin-top: 18px; padding-left: 55px;">
        Try our new <a href="@Url.Action("WebApi", "Home")"><strong>web api!</strong></a>
        <img src="../../Content/img/new_feature.png" alt="" style="padding-left: 3px; margin-top: -3px" />
    </div>
</div>

<hr />

<div class="container" style="margin-top: 20px">
    <div class="row">
        <div class="container">
            <div class="row">
                <div class="col-md-4 col-md-offset-1">
                    <h4>Most wanted items</h4>
                    <table class="table table-bordered">
                        <tr>
                            <th style="width: 40px">Id</th>
                            <th>Name</th>
                            <th>#</th>
                        </tr>
                        <tbody>
                            @foreach (var item in Model.MostWantedItems)
                            {
                                <tr>
                                    <td>@item.Item.Id</td>
                                    <td>@item.Item.Name</td>
                                    <td>@item.Count</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="col-md-4 col-md-offset-1">
                    <h4>Most offered items</h4>
                    <table class="table table-bordered">
                        <tr>
                            <th style="width: 40px">Id</th>
                            <th>Name</th>
                            <th>#</th>
                        </tr>
                        <tbody>
                            @foreach (var item in Model.MostOfferedItems)
                            {
                                <tr>
                                    <td>@item.Item.Id</td>
                                    <td>@item.Item.Name</td>
                                    <td>@item.Count</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- #region Categories and subcategories -->
    <div class="row" style="margin-top: 5px">
        <div class="col-md-5 col-md-offset-1">
            Most wanted <strong>category</strong>:
            @if (Model.MostWantedCategory != null)
            {
                @Model.MostWantedCategory
            }
            else
            {
                <em>no data available!</em>
            }
        </div>
        <div class="col-md-5">
            Most offered <strong>category</strong>:
            @if (Model.MostOfferedCategory != null)
            {
                @Model.MostOfferedCategory
            }
            else
            {
                <em>no data available!</em>
            }
        </div>
    </div>
    <div class="row" style="margin-top: 5px">
        <div class="col-md-5 col-md-offset-1">
            Most wanted <strong>subcategory</strong>:
            @if (Model.MostWantedSubcategory != null)
            {
                @Model.MostWantedSubcategory
            }
            else
            {
                <em>no data available!</em>
            }
        </div>
        <div class="col-md-5">
            Most offered <strong>subcategory</strong>:
            @if (Model.MostOfferedSubcategory != null)
            {
                @Model.MostOfferedSubcategory
            }
            else
            {
                <em>no data available!</em>
            }
        </div>
    </div>
    <!-- #endregion -->

    <div class="row" style="margin-top: 25px">
        <div class="jumbotron">
            <div class="row" style="margin-top: -20px">
                <div class="col-md-2">
                    Trends by item
                </div>
                <div class="col-md-2">
                    @Html.LabelFor(model => model.ItemId)
                    @Html.DropDownListFor(
                        model => model.ItemId,
                        Model.Items,
                        "Choose... ")
                    @Html.ValidationMessageFor(model => model.ItemId, "", new { @class = "text-danger" })
                </div>
            </div>
            <div id="chart">
                @Html.Partial("_TrendsChart", Model.Chart);
            </div>
        </div>
    </div>
</div>

@section scripts {
    @Scripts.Render("~/bundles/highcharts")

    <script>
        $(function () {
            $("#ItemId").change(function () {
                var itemId = $("#ItemId").val();
                $("#chart").load(
                    '@(Url.Action("GetDailyTrendsFor", "Analytics"))?itemId=' + itemId);
            });
        });
    </script>
}